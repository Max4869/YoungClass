<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小天才学习助手</title>
    <style>
        /* 🎨 整体UI风格 */
        :root {
            --bg-light: #fefefe; /* 米白 */
            --bg-panel: #fdfdfd; /* 浅米白 */
            --accent-orange: #ff9800;
            --accent-green: #4caf50;
            --text-dark: #333;
            --border-color: #ddd;
            --font-main: "Comic Sans MS", "Arial Rounded MT Bold", "PingFang SC", "Microsoft YaHei", sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-light);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            font-size: 16px;
        }

        .container {
            display: flex;
            max-width: 1200px;
            margin: auto;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background-color: var(--bg-panel);
            min-height: 80vh;
        }

        /* 左右布局 */
        .left-panel, .right-panel {
            padding: 30px;
            box-sizing: border-box;
        }

        .left-panel {
            flex: 1;
            max-width: 400px;
            background-color: #f8f8f8;
            border-right: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }
        
        .right-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
        }
        
        h1, h2 {
            font-size: 2em;
            text-align: center;
            color: #1a73e8;
            margin-top: 0;
        }

        h3 {
            font-size: 1.5em;
            color: #4285f4;
            margin-bottom: 15px;
        }

        .section-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #3c4043;
        }
        .section-header span {
            margin-left: 8px;
        }
        .section-header .arrow {
            font-size: 1.5em;
            transition: transform 0.3s;
        }
        .section-header.collapsed .arrow {
            transform: rotate(-90deg);
        }

        /* 🧩 核心功能模块 - 题目类型选择 */
        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .type-selector button {
            flex: 1;
            padding: 12px 20px;
            font-size: 1.1em;
            border-radius: 8px;
            border: 2px solid var(--accent-orange);
            background-color: transparent;
            color: var(--accent-orange);
            cursor: pointer;
            transition: all 0.3s;
        }

        .type-selector button.active {
            background-color: var(--accent-orange);
            color: white;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }

        /* 通用表单元素 */
        .settings-group {
            padding: 15px;
            border-left: 3px solid var(--accent-orange);
            border-radius: 8px;
            background-color: #fafafa;
            margin-bottom: 20px;
            transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out;
            overflow: hidden;
            opacity: 1;
        }
        
        .settings-group.hidden {
            max-height: 0;
            padding: 0 15px;
            opacity: 0;
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input[type="text"], input[type="number"], textarea, input[type="file"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        
        .checkbox-group, .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-group label, .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: normal;
        }
        
        /* 单词测验设置盒子变大 */
        #vocab-settings {
            max-height: 800px;
        }

        /* 导出区按钮 */
        .action-buttons {
            display: flex;
            gap: 15px;
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
            margin-top: 20px;
        }

        .action-buttons button, .generate-btn, .timer-btn {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .generate-btn {
            background-color: var(--accent-green);
            color: white;
            width: 100%;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(76, 175, 80, 0.3);
        }
        
        .action-buttons button {
            flex: 1;
        }
        
        #start-match-btn {
            background-color: #5d9cec;
            color: white;
        }
        #grade-btn {
            background-color: #eb4434;
            color: white;
        }
        
        /* ✨ 创新点 - 预览区 */
        #preview-area {
            flex-grow: 1;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
            max-height: 600px;
            line-height: 1.8;
            border: 1px solid #e0e0e0;
        }

        .question-list {
            list-style: none;
            padding: 0;
        }

        .question-item {
            margin-bottom: 15px;
        }
        
        .question-item input {
            width: 80px;
            margin-left: 10px;
            text-align: center;
        }

        /* 题目排版模式 */
        .layout-exam .question-item {
            display: inline-block;
            width: 48%;
            vertical-align: top;
            margin-right: 2%;
            margin-bottom: 10px;
        }
        
        .layout-workbook .question-item {
            display: block;
            margin-bottom: 30px;
        }

        .correct-answer, .user-answer {
            font-weight: bold;
            display: none;
            margin-left: 5px;
        }
        
        .correct-answer {
            color: var(--accent-green);
        }

        .user-answer {
            color: var(--accent-orange);
        }
        
        .show-answers .correct-answer {
            display: inline;
        }

        /* 计时测验模式 */
        #timer-panel {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed var(--border-color);
        }

        #timer-display {
            font-size: 2.5em;
            color: var(--accent-orange);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .timer-btn {
            background-color: var(--accent-orange);
            color: white;
            padding: 10px 20px;
        }

        .score-display {
            font-size: 1.8em;
            color: var(--accent-green);
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .left-panel, .right-panel {
                max-width: 100%;
                border-right: none;
                height: auto;
                position: static;
            }
        }
    </style>
</head>
<body>

    <main class="container">
        
        <div class="left-panel">
            <h1>📘 学习助手</h1>
            
            <hr>

            <h3>题目类型</h3>
            <div class="type-selector">
                <button id="math-type-btn" class="active">口算题</button>
                <button id="vocab-type-btn">单词测验</button>
            </div>
            
            <div id="math-settings" class="settings-group">
                <div class="section-header">
                    <h3>口算题设置</h3>
                </div>
                
                <label>题型选择（可多选）</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="math-type" value="addition" checked> 加法</label>
                    <label><input type="checkbox" name="math-type" value="subtraction"> 减法</label>
                    <label><input type="checkbox" name="math-type" value="multiplication"> 乘法</label>
                    <label><input type="checkbox" name="math-type" value="division"> 除法</label>
                </div>
                
                <label>数字范围</label>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="number" id="math-min" value="0" placeholder="最小数" style="flex: 1;">
                    <input type="number" id="math-max" value="100" placeholder="最大数" style="flex: 1;">
                </div>
                
                <label>题目数量</label>
                <input type="number" id="question-count" value="20" min="1" max="500">
                
                <label>附加选项</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="include-parentheses"> 包含括号</label>
                    <label><input type="checkbox" id="include-decimals"> 带小数</label>
                    <label><input type="checkbox" id="include-negatives"> 涉及负数</label>
                </div>
            </div>
            
            <div id="vocab-settings" class="settings-group hidden">
                <div class="section-header">
                    <h3>单词测验设置</h3>
                </div>
                
                <label>单词来源</label>
                <div class="radio-group" style="margin-bottom: 10px;">
                    <label><input type="radio" name="word-source" value="manual" checked> 手动输入</label>
                    <label><input type="radio" name="word-source" value="upload"> 上传文件</label>
                    <input type="file" id="word-file-upload" style="width: auto; margin-left: -5px;" accept=".txt">
                    <label><input type="radio" name="word-source" value="builtin"> 内置词库</label>
                </div>
                <textarea id="word-input" rows="6" placeholder="输入单词，每行一个（例：apple 苹果）"></textarea>
                
                <label>测验类型</label>
                <div class="radio-group">
                    <label><input type="radio" name="vocab-type" value="zh-en" checked> 中文 → 英文</label>
                    <label><input type="radio" name="vocab-type" value="en-zh"> 英文 → 中文</label>
                    <label><input type="radio" name="vocab-type" value="fill-in"> 填空题</label>
                </div>
                
                <label>抽取数量</label>
                <input type="number" id="vocab-count" value="10" min="1" max="200">
            </div>

            <div class="settings-group">
                <div class="section-header">
                    <h3>附加功能</h3>
                </div>
                <label>随机种子（可固定题目）</label>
                <input type="text" id="random-seed" placeholder="输入任意文本">

                <label>题目排版模式</label>
                <div class="radio-group">
                    <label><input type="radio" name="layout-mode" value="exam" checked> 考卷模式</label>
                    <label><input type="radio" name="layout-mode" value="workbook"> 练习册模式</label>
                </div>
            </div>
            
            <button class="generate-btn" id="generate-btn">生成题目</button>
        </div>
        
        <div class="right-panel">
            <h2>试卷预览</h2>
            <div id="preview-area" class="layout-exam">
                <p style="text-align: center; color: #888;">请在左侧设置并生成题目</p>
            </div>
            
            <div class="action-buttons">
                <button id="start-match-btn">开始比赛</button>
                <button id="grade-btn" disabled>判分</button>
            </div>
            
            <div id="timer-panel">
                <div id="timer-display" style="display: none;">00:00</div>
                <div class="score-display" id="score-display" style="display: none;"></div>
            </div>
        </div>

    </main>

    <script>
        // 获取DOM元素
        const mathSettings = document.getElementById('math-settings');
        const vocabSettings = document.getElementById('vocab-settings');
        const mathTypeBtn = document.getElementById('math-type-btn');
        const vocabTypeBtn = document.getElementById('vocab-type-btn');
        const generateBtn = document.getElementById('generate-btn');
        const previewArea = document.getElementById('preview-area');
        const startMatchBtn = document.getElementById('start-match-btn');
        const gradeBtn = document.getElementById('grade-btn');
        const layoutModeRadios = document.querySelectorAll('input[name="layout-mode"]');
        const timerDisplay = document.getElementById('timer-display');
        const scoreDisplay = document.getElementById('score-display');
        const wordSourceRadios = document.querySelectorAll('input[name="word-source"]');
        const wordInput = document.getElementById('word-input');
        const wordFileUpload = document.getElementById('word-file-upload');
        
        let isMathMode = true;
        let correctAnswers = [];
        let timerInterval;

        const builtInVocab = [
            { en: 'apple', zh: '苹果' },
            { en: 'banana', zh: '香蕉' },
            { en: 'orange', zh: '橙子' },
            { en: 'grape', zh: '葡萄' },
            { en: 'pear', zh: '梨子' },
            { en: 'cat', zh: '猫' },
            { en: 'dog', zh: '狗' },
            { en: 'bird', zh: '鸟' },
            { en: 'fish', zh: '鱼' },
            { en: 'rabbit', zh: '兔子' },
            { en: 'sun', zh: '太阳' },
            { en: 'moon', zh: '月亮' },
            { en: 'star', zh: '星星' },
            { en: 'cloud', zh: '云' },
            { en: 'rain', zh: '雨' },
            { en: 'red', zh: '红色' },
            { en: 'blue', zh: '蓝色' },
            { en: 'green', zh: '绿色' },
            { en: 'yellow', zh: '黄色' },
            { en: 'black', zh: '黑色' },
            { en: 'one', zh: '一' },
            { en: 'two', zh: '二' },
            { en: 'three', zh: '三' },
            { en: 'four', zh: '四' },
            { en: 'five', zh: '五' },
            { en: 'school', zh: '学校' },
            { en: 'teacher', zh: '老师' },
            { en: 'student', zh: '学生' },
            { en: 'book', zh: '书' },
            { en: 'pen', zh: '钢笔' },
            { en: 'happy', zh: '快乐的' },
            { en: 'sad', zh: '悲伤的' },
            { en: 'angry', zh: '生气的' },
            { en: 'hungry', zh: '饥饿的' },
            { en: 'thirsty', zh: '口渴的' }
        ];

        // --- 事件监听器 ---

        // 切换题目类型
        mathTypeBtn.addEventListener('click', () => {
            isMathMode = true;
            mathTypeBtn.classList.add('active');
            vocabTypeBtn.classList.remove('active');
            mathSettings.classList.remove('hidden');
            vocabSettings.classList.add('hidden');
        });

        vocabTypeBtn.addEventListener('click', () => {
            isMathMode = false;
            vocabTypeBtn.classList.add('active');
            mathTypeBtn.classList.remove('active');
            vocabSettings.classList.remove('hidden');
            mathSettings.classList.add('hidden');
        });

        // 切换单词来源
        wordSourceRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                wordInput.style.display = (e.target.value === 'manual') ? 'block' : 'none';
                wordFileUpload.style.display = (e.target.value === 'upload') ? 'inline-block' : 'none';
            });
        });
        wordFileUpload.style.display = 'none';

        // 生成题目按钮
        generateBtn.addEventListener('click', () => {
            if (isMathMode) {
                generateMathProblems();
            } else {
                generateVocabQuestions();
            }
            // 重置比赛状态
            if (timerInterval) clearInterval(timerInterval);
            timerDisplay.style.display = 'none';
            scoreDisplay.style.display = 'none';
            startMatchBtn.innerText = '开始比赛';
            gradeBtn.disabled = true;
        });

        // 题目排版模式切换
        layoutModeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                previewArea.className = '';
                previewArea.classList.add(e.target.value === 'exam' ? 'layout-exam' : 'layout-workbook');
            });
        });
        
        // 开始比赛按钮
        let startTime;
        startMatchBtn.addEventListener('click', () => {
            if (timerInterval) {
                // Stop timer
                clearInterval(timerInterval);
                startMatchBtn.innerText = '开始比赛';
                gradeBtn.disabled = false;
            } else {
                // Start timer
                startTime = Date.now();
                startMatchBtn.innerText = '停止比赛';
                timerDisplay.style.display = 'block';
                scoreDisplay.style.display = 'none';
                gradeBtn.disabled = true;
                
                timerInterval = setInterval(() => {
                    const totalTime = Math.floor((Date.now() - startTime) / 1000);
                    const minutes = Math.floor(totalTime / 60).toString().padStart(2, '0');
                    const seconds = (totalTime % 60).toString().padStart(2, '0');
                    timerDisplay.innerText = `${minutes}:${seconds}`;
                }, 1000);
            }
        });

        // 判分按钮
        gradeBtn.addEventListener('click', () => {
            let correctCount = 0;
            const userInputs = document.querySelectorAll('#preview-area input');
            userInputs.forEach((input, index) => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = correctAnswers[index];
                
                const questionItem = input.closest('li');
                
                // 移除旧的答案提示
                const oldAnswers = questionItem.querySelectorAll('.result-display');
                oldAnswers.forEach(el => el.remove());

                const resultDisplay = document.createElement('div');
                resultDisplay.className = 'result-display';
                
                const userAnswerSpan = document.createElement('span');
                userAnswerSpan.className = 'user-answer';
                userAnswerSpan.innerText = `你的答案: ${userAnswer}`;
                
                const correctAnswerSpan = document.createElement('span');
                correctAnswerSpan.className = 'correct-answer';
                correctAnswerSpan.innerText = `正确答案: ${correctAnswer}`;
                
                if (userAnswer === correctAnswer) {
                    correctCount++;
                    input.style.borderColor = 'var(--accent-green)';
                } else {
                    input.style.borderColor = 'var(--accent-orange)';
                }
                
                resultDisplay.appendChild(userAnswerSpan);
                resultDisplay.appendChild(correctAnswerSpan);
                questionItem.appendChild(resultDisplay);
            });
            
            const totalQuestions = userInputs.length;
            const score = (correctCount / totalQuestions * 100).toFixed(0);
            scoreDisplay.style.display = 'block';
            scoreDisplay.innerHTML = `得分：${score} / 100<br>正确率：${correctCount} / ${totalQuestions}`;
            previewArea.classList.add('show-answers');
        });
        
        // --- 核心功能实现函数 ---

        function seedRandom(seed) {
            let s = 0;
            if (seed) {
                for (let i = 0; i < seed.length; i++) {
                    s += seed.charCodeAt(i);
                }
            } else {
                s = Math.random() * 10000;
            }
            return () => {
                s = (s * 9301 + 49297) % 233280;
                return s / 233280;
            };
        }
        
        function generateMathProblems() {
            const mathTypes = Array.from(document.querySelectorAll('input[name="math-type"]:checked')).map(cb => cb.value);
            const minNum = parseFloat(document.getElementById('math-min').value);
            const maxNum = parseFloat(document.getElementById('math-max').value);
            const count = parseInt(document.getElementById('question-count').value);
            const includeParentheses = document.getElementById('include-parentheses').checked;
            const includeDecimals = document.getElementById('include-decimals').checked;
            const includeNegatives = document.getElementById('include-negatives').checked;
            const seed = document.getElementById('random-seed').value;
            const random = seedRandom(seed);
            
            if (mathTypes.length === 0 || isNaN(minNum) || isNaN(maxNum) || isNaN(count) || count <= 0) {
                alert('请完整填写口算题设置！');
                return;
            }

            let problemsHTML = '';
            correctAnswers = [];
            for (let i = 1; i <= count; i++) {
                const type = mathTypes[Math.floor(random() * mathTypes.length)];
                let num1, num2, operator, answer;
                
                // 根据小数和负数选项生成数字
                const getNum = () => {
                    let num = minNum + random() * (maxNum - minNum);
                    if (!includeDecimals) {
                        num = Math.round(num);
                    }
                    if (!includeNegatives && num < 0) {
                        num = Math.abs(num);
                    }
                    return parseFloat(num.toFixed(2));
                };

                num1 = getNum();
                num2 = getNum();

                switch(type) {
                    case 'addition':
                        operator = '+';
                        answer = num1 + num2;
                        break;
                    case 'subtraction':
                        operator = '-';
                        answer = num1 - num2;
                        break;
                    case 'multiplication':
                        operator = '×';
                        answer = num1 * num2;
                        break;
                    case 'division':
                        operator = '÷';
                        // 确保能整除
                        if (!includeDecimals) {
                            num1 = num1 * num2;
                        }
                        answer = num1 / num2;
                        break;
                }
                
                let expression = `${num1} ${operator} ${num2}`;
                if (includeParentheses && random() > 0.5) {
                    expression = `(${num1} ${operator} ${num2})`;
                }
                
                const finalAnswer = answer.toFixed(2).replace(/\.?0+$/, '');
                correctAnswers.push(finalAnswer);

                problemsHTML += `<li class="question-item">
                                    ${i}. ${expression} = <input type="text" data-answer="${finalAnswer}">
                                </li>`;
            }
            
            previewArea.innerHTML = `<ol class="question-list">${problemsHTML}</ol>`;
            previewArea.classList.remove('show-answers');
        }
        
        async function generateVocabQuestions() {
            const wordSource = document.querySelector('input[name="word-source"]:checked').value;
            const vocabType = document.querySelector('input[name="vocab-type"]:checked').value;
            const count = parseInt(document.getElementById('vocab-count').value);
            const seed = document.getElementById('random-seed').value;
            const random = seedRandom(seed);
            
            let words = [];
            if (wordSource === 'manual') {
                const wordInput = document.getElementById('word-input').value;
                words = wordInput.split('\n').filter(w => w.trim() !== '').map(line => {
                    const parts = line.split(/\s+/);
                    return { en: parts[0], zh: parts.slice(1).join(' ') };
                });
            } else if (wordSource === 'builtin') {
                words = builtInVocab;
            } else if (wordSource === 'upload') {
                const file = wordFileUpload.files[0];
                if (!file) {
                    alert('请先选择一个文件！');
                    return;
                }
                const text = await file.text();
                words = text.split('\n').filter(w => w.trim() !== '').map(line => {
                    const parts = line.split(/\s+/);
                    return { en: parts[0], zh: parts.slice(1).join(' ') };
                });
            }

            if (words.length === 0 || isNaN(count) || count <= 0) {
                alert('单词列表为空或题目数量不正确！');
                return;
            }

            const shuffledWords = [...words].sort(() => random() - 0.5).slice(0, count);

            let problemsHTML = '';
            correctAnswers = [];
            shuffledWords.forEach((word, index) => {
                let question = '';
                let answer = '';
                
                switch(vocabType) {
                    case 'zh-en':
                        // 随机生成提示的字母数量，至少保留一个字母
                        const hintLength = Math.max(1, Math.floor(word.en.length * (0.25 + random() * 0.5)));
                        const hintStart = Math.floor(random() * (word.en.length - hintLength + 1));
                        
                        let hint = '';
                        for(let i = 0; i < word.en.length; i++) {
                            if (i >= hintStart && i < hintStart + hintLength) {
                                hint += word.en[i];
                            } else {
                                hint += '_';
                            }
                        }

                        question = `${word.zh} (${hint})`;
                        answer = word.en;
                        break;
                    case 'en-zh':
                        question = word.en;
                        answer = word.zh;
                        break;
                    case 'fill-in':
                        const fillPos = Math.floor(random() * (word.en.length - 2)) + 1;
                        question = word.en.substring(0, fillPos) + '____' + word.en.substring(fillPos + 1);
                        answer = word.en;
                        break;
                }
                
                correctAnswers.push(answer.toLowerCase());

                problemsHTML += `<li class="question-item">
                                    ${index + 1}. ${question}
                                    <input type="text" data-answer="${answer.toLowerCase()}">
                                </li>`;
            });
            
            previewArea.innerHTML = `<ol class="question-list">${problemsHTML}</ol>`;
            previewArea.classList.remove('show-answers');
        }

        // 初始生成一次
        generateMathProblems();

    </script>
</body>
</html>